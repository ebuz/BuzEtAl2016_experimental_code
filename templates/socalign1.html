<!DOCTYPE html>
<html>
  <head>
    <title>SocAlign1</title>
    <meta charset=utf-8"/>
    <style type="text/css">
      body {
        width: 100%;
        height: auto;
        margin:0;
        padding:0;
        text-align:center;
      }
      div#testing {
        position:absolute;
        width: 98%;
        top: 1%;
        left: 1%;
        height: 500px;
        text-align: center;
        margin: 0 auto;
      }
      div#startmessage {
        position:absolute;
        width: 98%;
        height: 80%;
        top: 1%;
        left: 1%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      div.testtrial {
        position:absolute;
        width: 98%;
        height: 80%;
        top: 1%;
        left: 1%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      div.stimuliframe {
        position: absolute;
        top: 25%;
        width: 90%;
        height: 50%;
        left: 5%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      div.pretrialsync {
        position: absolute;
        top: 25%;
        width: 90%;
        height: 50%;
        left: 5%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      div.fixation {
        position: absolute;
        top: 0%;
        width: 90%;
        height: 100%;
        left: 5%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      div.posttrialwait {
        position: absolute;
        top: 25%;
        width: 90%;
        height: 50%;
        left: 5%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      div.position1{
        position: absolute;
        top: 39.5%;
        width: 30%;
        height: 20%;
        left: 3%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
        border: 2px solid white;
      }
      div.position2{
        position: absolute;
        top: 39.5%;
        width: 30%;
        height: 20%;
        left: 34.5%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
        border: 2px solid white;
      }
      div.position3{
        position: absolute;
        top: 39.5%;
        width: 30%;
        height: 20%;
        right: 3%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
        border: 2px solid white;
      }
      div.stimulus {
        position: absolute;
        top: 0%;
        width: 100%;
        height: 100%;
        left: 0%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
        font-size: 2em;
      }
      div.timerbar {
        position: absolute;
        width: 100%;
        height: 5%;
        bottom: 0%;
        right: 0%;
        background-color: gray;
      }
      img.fixationcross{
        position: relative;
        top: 25.5%;
        height: 50%;
        margin-left: auto;
        margin-right: auto;
        width: auto;
      }
      img.speakercue{
        position: absolute;
        top: -50%;
        left: 10%;
        height: 50%;
        width: auto;
        display: none;
      }
      img.partnercue{
        position: absolute;
        top: -50%;
        right: 10%;
        height: 50%;
        width: auto;
        display: none;
      }
      #partnersync {
        position: absolute;
        top: 25%;
        width: 90%;
        height: 50%;
        left: 5%;
        text-align: center;
        float:0 auto;
        margin: 0 auto;
      }
      table.survquest {
        width: 400px;
        border: solid 1px;
        margin: 2em;
      }
      table.survquest td {
        text-align: center;
        vertical-align:top;
        width: 14%;
      }
      table.survquest p.sentence, #textqs span {
        width: 400px;
        font-size: large;
        font-weight: bold;
        text-align: center;
      }
      label {
        font-weight: bold;
        font-size: 175%;
        border: 1px dashed black;
      }
      #survey ul {
        list-style: none;
      }
      #textqs li {
        width: 400px;
        border: 1px solid black;
        margin-right: -1em;
        margin-top: 2em;
        padding: 1em;
      }
      #micwarning, #oldBrowserMessage, #earlyStop, #page1, #page2, #page3, #page4, #debriefing, #submit, #comment, #testing, .testtrial, .fixation, .stimuliframe, .timerbar, .posttrialwait {display:none;}
      {% if not preview %}
      #instructions, #realinstructions {display:none;}
      {% endif %}
    </style>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="/mturk/iso8601shim.min.js"></script>
    <script type="text/javascript" src="/mturk/jquery.timers-1.2.js"></script>
    <script type="text/javascript" src="/mturk/modernizr.audiocanvas.js"></script>
    {% if not preview %}
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
    <script type="text/javascript" src="/mturk/recorder.js"></script>
    <script type="text/javascript" src="/mturk/wami-helpers.js"></script>
    <script type="text/javascript" src="/mturk/socalign1.js"></script>
    <script type="text/javascript">
      var hitId = "{{amz.hitId}}";
      var workerId = "{{amz.workerId}}";
      var assignmentId = "{{amz.assignmentId}}";
      var amzhash = "{{amz.hash}}"
      var debugmode = {{debugmode}};
      var recorder_url = "{{recorder_url}}";
      var itemno = {{startitem}};
      var experiment = "SocAlign.1";
    </script>
    {% endif %}
    </head>

    <body>
      {% include 'instructions.html' %}
      {#
      Loading items is not necessary on preview. In fact, the flash in
      particular takes a *long* time to load.
      #}
      {% if not preview %}
      <div id="wami"></div>

      <div id="oldBrowserMessage">
        <p>Your browser does not appear to be compatible with the audio elements used in this HIT. </p>
        <p>Please <strong>do not accept this HIT</strong>, your results will be automatically rejected.  </p>
        <p>If you'd like to do this HIT, download an up-to-date version of one of these browsers and try again:</p>
        <div id="browserIcons">
          <a target="_blank" href="http://www.google.com/chrome"><img src="/mturk/img/64-chrome.png" alt=""/></a>
          <a target="_blank" href="http://www.mozilla.com/en-US/firefox/new/"><img src="/mturk/img/64-firefox.png" alt=""/></a>
          <a target="_blank" href="http://www.opera.com/"><img src="/mturk/img/64-opera.png" alt=""/></a>
          <a target="_blank" href="http://www.apple.com/safari/"><img src="/mturk/img/64-safari.png" alt=""/></a>
        </div>
      </div>

      {% if formtype == 'sandbox' %}
      <form id="results" method="post" action="https://workersandbox.mturk.com/mturk/externalSubmit">
      {% elif formtype == 'live' %}
      <form id="results" method="post" action="https://www.mturk.com/mturk/externalSubmit">
      {% elif formtype == 'testing' %}
      <form id="results" method="post" action="http://www.hlp.rochester.edu/cgi-bin/postdetails.pl">
      {% else %}
      <form id="results" method="post" action="">
      {% endif %}

      <div id="testing">
        <div id="startmessage">
          <div id="partnersync">
            <p id="partnersyncmsg">Please wait a moment while we sync you with a partner, this initial connection generally takes 30 second to 2 minutes. Each trial will have a much shorter sync screen as well, usually not longer than 2 seconds.</p>
            <p>You've been waiting <span id="synctimer">0</span> seconds</p>
            <div id="initialsync">
                <img src="/mturk/img/microphone.png">
                <img src="/mturk/img/arrow.png">
                <img src="/mturk/img/internet.png">
                <img src="/mturk/img/arrow.png">
                <img src="/mturk/img/headphone.png">
            </div>
          </div>
          {% if debugmode %}
          <button type="button" id="starttest">Start</button>
          {% else %}
          <button type="button" id="starttest" disabled>Start</button>
          {% endif %}
        </div>
        {% for item in testtrials %}
          <div id="trial{{loop.index}}" class="testtrial">
            <div class="pretrialsync">
                <img src="/mturk/img/microphone.png">
                <img src="/mturk/img/arrow.png">
                <img src="/mturk/img/internet.png">
                <img src="/mturk/img/arrow.png">
                <img src="/mturk/img/headphone.png">
            </div>
            <div class="fixation">
              <img class="fixationcross" src="/mturk/img/fixation.png">
            </div>
            <div class="stimuliframe">
              <div class="position1">
                <img class="speakercue" src="/mturk/img/microphone.png">
                <img class="partnercue" src="/mturk/img/headphone.png">
                <div class="stimulus">
                  {{item.Position1}}
                </div>
              </div>
              <div class="position2">
                <img class="speakercue" src="/mturk/img/microphone.png">
                <img class="partnercue" src="/mturk/img/headphone.png">
                <div class="stimulus">
                  {{item.Position2}}
                </div>
              </div>
              <div class="position3">
                <img class="speakercue" src="/mturk/img/microphone.png">
                <img class="partnercue" src="/mturk/img/headphone.png">
                <div class="stimulus">
                  {{item.Position3}}
                </div>
              </div>
            </div>
            <div class="timerbar"></div>
            <div class="posttrialwait">
              <p class="feedbackmsg"></p>
              <p class="posttrialmsg">Please click the button or press the space bar in the next 30 seconds to start the next trial.</p>
              <button type="button" id="{{item.ItemID}}" class="nexttrial">30</button>
            </div>
            <button type="button" class="hiddennext" style="display: none !important"></button>
            <input type="hidden" class = "targetposition", id="targetposition_{{item.ItemID}}" name="targetposition_{{item.ItemID}}" value="{{item.TargetCompetitorPositions}}"/>
            <input type="hidden" class = "partnerresponsetime", id="partnerresponsetime_{{item.ItemID}}" name="partnerresponsetime_{{item.ItemID}}" value="{{item.PartnerResponseTime}}"/>
            <input type="hidden" class = "partnerresponse", id="partnerresponse_{{item.ItemID}}" name="partnerresponse_{{item.ItemID}}" value="{{item.PartnerResponse}}"/>
            <input type="hidden" class = "partnerfeedback", id="partnerfeedback_{{item.ItemID}}" name="partnerfeedback_{{item.ItemID}}" value="{{item.PartnerFeedbackType}}"/>
          </div>
        {% endfor %}

      </div>
      <div id="earlyStop">
        <p>You took too long to advance, for the sake of your partner's time we have ended the experiment. Please fill out the post experiment survey.</p>
        <button type="button" id="tosurvey">Continue</button>
        {% if debugmode == 1 -%}
        <button type="button" id="reset">Reset</button>
        {%- endif %}
      </div>

        {% include 'survey.html' %}

          <div id="hiddenfields">
            <!--<input type="hidden" id="starttime" name="starttime" value="NA"/>
            <input type="hidden" id="endaudio" name="endaudio" value="NA"/>-->
            <input type="hidden" id="experiment" name="experiment" value="SocAlign1"/>
            <input type="hidden" id="list" name="ListID" value="{{ListID}}"/>
            <input type="hidden" id="assignmentId" name="assignmentId" value="{{amz.assignmentId}}"/>
            <input type="hidden" id="browserid" name="browserid" value="NA"/>
            <input type="hidden" id="endearly" name="endearly" value="NA"/>
          </div>
          <div id="comment">
            <p>Feedback on this HIT (optional):</p>
            <p><textarea id="commentarea" name="comment" cols="80" rows="3"></textarea></p>
          </div>
          <button type="submit" name="submit" id="submit" disabled="disabled">Submit</button>
        </form>
      </div>
      {% endif %}
    </body>

  </html>
